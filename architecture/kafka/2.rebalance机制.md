# rebalance机制
## 触发原因
- 消费者组内成员发生变更，这个变更包括增加和减少消费者。注意这里的减少有很大可能是被动的，就是某个消费者奔溃退出了
- 主题分区数发生变更，kafka目前只支持增加分区，当增加的时候就会触发重新平衡
- 订阅的主题发生变化，当消费者组使用正则表达式订阅主题，而恰好又新建了对应的主题，就会触发重平衡

## 影响
- 重平衡过程中，消费者无法从kafka消费消息，这对kafka的tps影响极大，而如果kafka集群内节点较多，比如数百个，那重平衡可能会耗时极多。数分钟到数小时都有可能，而这段时间kafka基本处于不可用状态，所以在实际生产环境，应该尽量避免重平衡发生

## 流程
- kafka Java消费者需要定期地发送心跳请求到broker端的协调者，以表明它还存活着
- 重平衡的通知机制正是通过心跳线程来完成的